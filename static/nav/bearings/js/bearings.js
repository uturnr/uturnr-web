function preload(){game.add.text(265,226,"LOADING",{font:"24px Arial",fill:"#fff"}),game.load.image("red","assets/red.png"),game.load.image("green","assets/green.png"),game.load.image("white","assets/line.png"),game.load.image("radar","assets/radar.png"),game.load.image("grey","assets/grey.png")}function shuffleArray(e){for(var t=e.length-1;t>0;t--){var r=Math.floor(Math.random()*(t+1)),n=e[t];e[t]=e[r],e[r]=n}return e}function create(){game.physics.startSystem(Phaser.Physics.ARCADE),game.add.sprite(0,0,"radar"),whiteline=game.add.sprite(320,240,"white"),linelayer=game.add.group(),textlayer=game.add.group(),whitetext=game.add.text(10,60,"360",{font:"bold 28px Arial",fill:"#fff"}),whitetext.stroke="#000000",whitetext.strokeThickness=6,redtext=game.add.text(10,35,"",{font:"bold 28px Arial",fill:"#ff0000"}),redtext.stroke="#000000",redtext.strokeThickness=6,greentext=game.add.text(10,35,"",{font:"bold 28px Arial",fill:"#00ff00"}),greentext.stroke="#000000",greentext.strokeThickness=6,placetext=game.add.text(10,10,"",{font:"bold 25px Arial",fill:"#fff"}),placetext.stroke="#000000",placetext.strokeThickness=6;var e=game.add.text(10,325,"Round",{font:"14px Arial",fill:"#fff"});e.stroke="#000000",e.strokeThickness=6,roundscore=game.add.text(10,340,1,{font:"bold 28px Arial",fill:"#fff"}),roundscore.stroke="#000000",roundscore.strokeThickness=6;var t=game.add.text(10,375,"Completed",{font:"14px Arial",fill:"#fff"});t.stroke="#000000",t.strokeThickness=6,correctscore=game.add.text(10,390,0,{font:"bold 28px Arial",fill:"#fff"}),correctscore.stroke="#000000",correctscore.strokeThickness=6;var r=game.add.text(10,425,"First Try",{font:"14px Arial",fill:"#00ff00"});r.stroke="#000000",r.strokeThickness=6,firsttryscore=game.add.text(10,440,0,{font:"bold 28px Arial",fill:"#00ff00"}),firsttryscore.stroke="#000000",firsttryscore.strokeThickness=6,newroundtext=game.add.text(320,240,"",{font:"bold 48px Arial",fill:"#fff",align:"center"}),newroundtext.anchor.set(.5),newroundtext.stroke="#000000",newroundtext.strokeThickness=6}function update(){if(currentquestion<questionbank.length)currentplacebearing=parseInt(placebearing[questionbank[currentquestion]].substring(0,3)),placetext.setText(place[questionbank[currentquestion]]);else{round++,newroundtext.setText("Round\n"+round),timerEvent=game.time.events.add(2*Phaser.Timer.SECOND,hideround,this),correctcount=0;for(var e=0;mastered.length>0;)questionbank.splice(mastered[0]-e,1),mastered.splice(0,1),e++;currentquestion=0,firstcount=0}drawnangle=game.physics.arcade.angleToPointer(whiteline)-1.57,mouseangle=Math.round(Math.atan2(game.input.y-240,game.input.x-320)*(180/Math.PI)),roundscore.setText(round),correctscore.setText(correctcount+" / "+questionbank.length),firsttryscore.setText(firstcount+" / "+questionbank.length),currentplacebearing>=90&&270>=currentplacebearing&&(correctangle=currentplacebearing-90),90>currentplacebearing&&currentplacebearing>=0&&(correctangle=currentplacebearing-90),360>=currentplacebearing&&currentplacebearing>270&&(correctangle=currentplacebearing-450),mouseangle>=0&&180>=mouseangle&&(mouseangle+=90),-1>=mouseangle&&mouseangle>=-90&&(mouseangle+=90),-91>=mouseangle&&mouseangle>=-180&&(mouseangle+=450),0==mouseangle&&(mouseangle=360),mouseangle>=1&&9>=mouseangle&&(mouseangle="00"+mouseangle),mouseangle>=10&&99>=mouseangle&&(mouseangle="0"+mouseangle),1==gamephase&&(greentext.setText(""),"undefined"!=typeof mouseangle&&whitetext.setText(mouseangle),whiteline.rotation=drawnangle,game.input.onUp.add(function(){1==gamephase&&(mouseangle>=currentplacebearing-5&&currentplacebearing+5>=mouseangle?(correct=!0,1==correct&&(correctcount++,correct=!1,firstwrong=!0),1==firsttry&&(firstcount++,mastered.push(currentquestion),firsttry=!1),redtext.setText(""),greentext.setText(placebearing[questionbank[currentquestion]]),whitetext.setText(mouseangle),greenline=linelayer.create(320,240,"green"),greenline.rotation=Math.radians(correctangle)-1.57,firstcount!=questionbank.length?(gamephase=2,delayTimer()):(gamephase=2,timerEvent=game.time.events.add(2*Phaser.Timer.SECOND,alldone,this))):(firsttry=!1,1==firstwrong&&(redline=linelayer.create(320,240,"red"),firstwrong=!1),redline.rotation=drawnangle,redtext.setText(mouseangle)))}))}function nextQuestion(){destroyGroup(linelayer),0==firsttry&&(currentquestion++,masterquestion++,firsttry=!0)}function alldone(){var e=Math.round(100*(numberofquestions/masterquestion)),t="s";1==round&&(t=""),gamephase=4,game.add.sprite(0,0,"grey"),gameovertext=game.add.text(320,240,"",{font:"bold 32px Arial",fill:"#fff",align:"center"}),gameovertext.anchor.set(.5),gameovertext.stroke="#000000",gameovertext.strokeThickness=6,encouragement=100==e?"Excellent!":e>80?"Well Done!":"Keep Practising!",gameovertext.setText(encouragement+"\nYou chose the correct bearing\non your first try "+e+"% of the time.\nYou completed the game in "+round+" round"+t+".")}function hideround(){newroundtext.setText("")}function delayTimer(){timerEvent=game.time.events.add(2*Phaser.Timer.SECOND,nextQuestion,this)}function destroyGroup(e,t){for(e.length;e.length>0;)obj=e.getAt(0),obj.destroy?obj.destroy():e.removeBetween(-1,1);gamephase=1}for(var game=new Phaser.Game(640,480,Phaser.CANVAS,'container',{preload:preload,create:create,update:update}),whiteline,greenline,mouseangle,whitetext,redtext,greentext,placetext,firstcount=0,questionbank=[],i=0;i<place.length;i++)questionbank[i]=i;var currentquestion=0,mastered=[],lowanswer,highanswer,firsttry=!0,correct=!1,drawnangle,correctangle,currentplacebearing,redline,linelayer,textlayer,firsttryscore,gamephase=1,timerEvent,round=1,gameovertext,masterquestion=1,numberofquestions=place.length,correctscore,correct,correctcount=0,firstwrong=!0,newroundtext,encouragement;shuffleArray(questionbank),Math.radians=function(e){return e*Math.PI/180};